<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gistone.mapper.DataSurveyMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gistone.entity.DataSurvey">
        <id column="survey_id" property="surveyId" />
        <result column="user_id" property="userId" />
        <result column="survey_name" property="surveyName" />
        <result column="survey_time" property="surveyTime" />
        <result column="survey_lon" property="surveyLon" />
        <result column="survey_lat" property="surveyLat" />
        <result column="survey_altitude" property="surveyAltitude" />
        <result column="survey_temperature" property="surveyTemperature" />
        <result column="survey_weather" property="surveyWeather" />
        <result column="survey_data" property="surveyData" />
        <result column="survey_stxt" property="surveyStxt" />
        <result column="survey_hjzl" property="surveyHjzl" />
        <result column="survey_rwhd" property="surveyRwhd" />
        <result column="survey_ps01" property="surveyPs01" />
        <result column="survey_ps02" property="surveyPs02" />
        <result column="survey_ps03" property="surveyPs03" />
        <result column="survey_ps04" property="surveyPs04" />
    </resultMap>

	<!-- 根据用户id查询红线块 -->
	<select id="getRedLindList" resultType="hashMap" parameterType="java.lang.String">
		SELECT t1.srld_id,t1.srld_name,CONCAT('[',
              GROUP_CONCAT(
                   CONCAT('{"lp_id":"',t1.lp_id,'"'),',',
                   CONCAT('"lm_id":"',lm_id,'"'),',',
                   CONCAT('"lp_lon":"',t1.lp_lon,'"'),
                   CONCAT(',"lp_lat":"',t1.lp_lat),'"}')
				,']') AS coordinate FROM (
			SELECT t1.srld_id,lm_id,srld_name,lp_id,lp_lon,lp_lat,lp_x,lp_y FROM (
				SELECT srld_id,lm_id,srld_name,lp_id,lp_lon,lp_lat,lp_x,lp_y FROM data_redline_register INNER JOIN lm_point ON srld_id = lp_srld_id 
				INNER JOIN lm_marker ON lm_lp_id = lp_id) t1
				INNER JOIN sys_user_redline glb ON t1.srld_id = glb.srld_id
				WHERE user_id = #{id} )t1
		GROUP BY t1.srld_id		
	</select>

	<!-- 查询得到最大主键 -->
    <select id="getPkid" parameterType="hashMap" resultType="java.lang.String">
    	SELECT max(survey_id) PKID from data_survey
    </select>


	
</mapper>
