<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gistone.mapper.ImageMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gistone.entity.Image">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="url" property="url" />
        <result column="shpurl" property="shpurl" />
        <result column="create_by" property="createBy" />
        <result column="create_date" property="createDate" />
        <result column="update_by" property="updateBy" />
        <result column="update_date" property="updateDate" />
        <result column="remark" property="remark" />
        <result column="del_flag" property="delFlag" />
        <result column="shp" property="shp" />
        <result column="contrast_red" property="contrastRed" />
        <result column="sign" property="sign" />
        <result column="evaluation" property="evaluation" />
        <result column="audit_date" property="auditDate" />
        <result column="country_border" property="countryBorder" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, name, url, shpurl, create_by, create_date, update_by, update_date, remark, del_flag, shp, contrast_red, sign, evaluation, audit_date, country_border
    </sql>
    <select id="getImageById"  parameterType="java.lang.Integer" resultType="com.gistone.entity.Image">
        SELECT * from image
        WHERE id = #{id}
        and del_flag = 1
	</select>

    <select id="selectISt4ScsCd"  parameterType="java.lang.Integer" resultType="com.gistone.entity.St4ScsCdVo">
        SELECT * from st4_scs_cd
        where CD009 = 1
        and image_id = #{id}
	</select>

    <select id="selectCount" resultType="java.util.Map">
        SELECT
           COUNT(*) as sum,
	      substring(CK086, 6, 5) AS date
        FROM
            `st4_scs_ck`
        WHERE

         CK086 &lt;= #{currentTime}
        AND CK086 &gt;= #{beforeTime}

        GROUP BY
        LEFT (CK086, 10)
    </select>

    <select id="selectBeforeCount" resultType="java.lang.Integer">
         SELECT
           COUNT(*)
        FROM
            `st4_scs_ck`
        WHERE
           CK086 &lt;= #{beforeTime}

    </select>

    <select id="getLastDataId" resultType="java.lang.Integer">
        SELECT
            s.image_id
        FROM
            (
                SELECT
                    COUNT(*),
                    image_id
                FROM
                    `st4_scs_cd` a
                GROUP BY
                    image_id
            ) s
        LEFT JOIN image b ON s.image_id = b.id
        ORDER BY
            b.create_date DESC
        LIMIT 1
    </select>

    <select id="getAreaGroupByType" resultType="java.util.Map">
        SELECT
            SUM(area) area,
            b.name as active_type
        FROM
            st4_scs_cd a
        INNER JOIN image_config b ON a.active_type = b.id
        WHERE
            a.image_id = #{id}
        GROUP BY
            a.active_type
    </select>

    <select id="getCountGroupByType" resultType="java.util.Map">
        SELECT
            count(*) count,
            b.`name` type
        FROM
            st4_scs_cd a
        LEFT JOIN image_config b ON a.active_type = b.id
        GROUP BY
            a.active_type
    </select>
    <select id="getAreaByType" resultType="java.util.Map">
        SELECT
            SUM(a.area) area,
            b.`name` type
        FROM
            st4_scs_cd a
        LEFT JOIN image_config b ON a.active_type = b.id
        GROUP BY
            a.active_type
    </select>



    <select id="getImageConfig" resultType="com.gistone.entity.ImageConfig">
        SELECT * from image_config LIMIT 1
    </select>

    <update id="updateImage" parameterType="Object" >
		update image
		<set>
            <if test="null!=contrastRed and ''!=contrastRed">
                contrast_red=#{contrastRed},
            </if>
            <if test="null!=evaluation and ''!=evaluation">
                evaluation=#{evaluation},
            </if>
            <if test="null!=sign">
                sign=#{sign},
            </if>
            <if test="null!=auditDate">
                audit_date=#{auditDate},
            </if>
            <if test="null!=auditPath">
                audit_path=#{auditPath},
            </if>
        </set>
		where id=#{id}
	</update>



    <insert id="insertImage" parameterType="com.gistone.entity.Image">
        INSERT INTO image
        (
            name,
            url,
            shpurl,
            create_by,
            create_date,
            update_by,
            update_date,
            remark,
            del_flag,
            shp,
            contrast_red,
            sign,
            evaluation,
            audit_date
        )
        VALUES(
            #{name},
            #{url},
            #{shpurl},
            #{createBy},
            #{createDate},
            #{updateBy},
            #{updateDate},
            #{remark},
            #{delFlag},
            #{shp},
            #{contrastRed},
            #{sign},
            #{evaluation},
            #{auditDate}
        )
    </insert>





</mapper>
